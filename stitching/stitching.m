function [C, D] = stitching(img1, img2, overpercent)
img1=rot90(img1);
img2=rot90(img2);
% figure;imshow(img1);%??
% figure;imshow(img2);

% %?????SIFT??,???????---------------------???? ??
% [des1, des2] = siftMatch(img{1}, img{2});
% des1=[des1(:,2),des1(:,1)];%???x?y??? ?????F ????????
% des2=[des2(:,2),des2(:,1)];%

% %? ????F ?????????
% matchs = matchFSelect(des1, des2) %??????????
% des1=des1(matchs,:);%????
% des2=des2(matchs,:);

% % ???????????????
% drawLinedCorner(img1,des1,img2, des2) ;
% %------------------------------------------------------???? ??

[H,W,k]=size(img1);%????
[H2,W2,k2]=size(img2);%????
% l_r=W-des1(1,2)+des2(1,2);%??????????????????
l_r=round(W*overpercent); %????????


% 1?????-------------------------------------------------

%[H,W,k]=size(img1);
%l_r=405;%?????W-? ? W?---?????????????????
L=W+1-l_r;%????
R=W;%????
n=R-L+1;%???????l_r
%?????
im=[img1,img2(:,n:W2,:)];%1??+2?????
% figure;imshow(im);title('?????');

% 2????????-------------------------------------------------
%????H????????????l_r???
A=img1(:,L:R,:);
B=img2(:,1:n,:);
%A?B ?????????????

% A=uint8(A); figure;imshow(A);
% B=uint8(B);figure;imshow(B);
%
[ma,na,ka]=size(A);
%I1=rgb2gray(A);%???????
I1 = A;
I1=double(I1);%??????
v1=0;
%I2= rgb2gray(B);
I2 = B;
I2=double(I2);
v2=0;
for i=1:ma
    for j=1:na
        %I1(i,j)=0.59*A(i,j,1)+0.11*A(i,j,2)+0.3*A(i,j,3);%????????
        v1=v1+I1(i,j);%??????????
        %I2(i,j)=0.59*B(i,j,1)+0.11*B(i,j,2)+0.3*B(i,j,3);
        v2=v2+I2(i,j);
    end
end

%figure;imshow(I1,[]);
%figure;imshow(I2,[]);

%???????????????
k=v1/v2;

BB2=img2(:,n:W2,:)*k;%???
im2=[img1,BB2];%??
% figure;imshow(im2);title('????????');


% 3????????-------------------------------------------------
% 4?????????????----------------------------------------

% ??????????

%????????????????

%[H,Y,t]=size(im);
C=im;%????
D=im2;%????????
% n=???;
%for i=1:H %?????
for j=1:n
    d=1-(j)/n;%disp(d);% ????
    C(1:H,L+j,:)=d*A(1:H,j,:)+(1-d)*B(1:H,j,:);%????
    D(1:H,L+j,:)=d*A(1:H,j,:)+(1-d)*B(1:H,j,:)*k;
end
%end
if isa(C, 'uint8')
    C=rot90(uint8(C), -1);
    % figure;imshow(C);title('???????');%3
    D=rot90(uint8(D), -1);
    % figure;imshow(D);title('??????????');%4
elseif isa(C, 'uint16')
    C=rot90(uint16(C), -1);
    % figure;imshow(C);title('???????');%3
    D=rot90(uint16(D), -1);
    % figure;imshow(D);title('??????????');%4
end